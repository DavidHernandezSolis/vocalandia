<ion-header>
  <ion-toolbar>
    <!-- Bot√≥n de regreso -->
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" text="Atr√°s"></ion-back-button>
    </ion-buttons>

    <!-- T√≠tulo centrado -->
    @if (!isWebMobile) {
    <ion-title>Configuraciones</ion-title>
    }

    <!-- Bot√≥n de logout si est√° logueado -->
    @if (isLoggedIn) {
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        Salir &nbsp;
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    }
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- validaci√≥n de challenge -->
  @if (showChallenge) {
  <ion-card>
    <ion-card-content>
      <h1>Solo un adulto puede continuar:</h1>
      <h2>{{ challenge?.question }}</h2>
      <ion-item>
        <ion-input type="number" placeholder="Tu respuesta" [(ngModel)]="userAnswer"></ion-input>
      </ion-item>
      <ion-button expand="block" (click)="validateChallenge()">
        Verificar
      </ion-button>
    </ion-card-content>
  </ion-card>
  }


  @if(allowAccess){
  <!-- REGISTRO DE NUEVOS USUARIOS -->
  @if (isSignin && !isLoggedIn) {
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="person-add-outline"></ion-icon>
        Registrar Nuevo Usuario
      </ion-card-title>
      <ion-card-subtitle>Agregar un nuevo usuario al sistema</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-select label="ROL *" [(ngModel)]="newUser.role_id" placeholder="Seleccione un rol">
          @for (role of roles; track $index) {
          @if (role.canlogin) {
          <ion-select-option [value]="role.id">
            {{ role.name }}
          </ion-select-option>
          }
          }
        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">NOMBRE COMPLETO *</ion-label>
        <ion-input type="text" placeholder="Nombre completo" [(ngModel)]="newUser.name">
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">EDAD *</ion-label>
        <ion-input type="number" placeholder="Edad en a√±os" [(ngModel)]="newUser.age">
        </ion-input>
      </ion-item>
      <ion-button expand="block" (click)="registerUser()" [disabled]="!newUser.name || !newUser.age "
        class="ion-margin-top">
        <ion-icon name="person-add-outline" slot="start"></ion-icon>
        Registrar Usuario
      </ion-button>
      <ion-button expand="block" (click)="loginsUser()" class="ion-margin-top">
        <ion-icon name="log-in-outline" slot="start"></ion-icon>
        Ir a iniciar sesion
      </ion-button>
    </ion-card-content>
  </ion-card>
  }

  <!-- SECCI√ìN DE AUTENTICACI√ìN -->
  @if (!isLoggedIn && !isSignin) {
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="log-in-outline"></ion-icon>
        Iniciar Sesi√≥n
      </ion-card-title>
      <ion-card-subtitle>Ingresa con tu usuario registrado</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-select label="ROL *" [(ngModel)]="loginForm.role_id" placeholder="Seleccione un rol">
          @for (role of roles; track $index) {
          @if (role.canlogin) {
          <ion-select-option [value]="role.id">
            {{ role.name }}
          </ion-select-option>
          }
          }

        </ion-select>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">NOMBRE COMPLETO *</ion-label>
        <ion-input type="text" placeholder="Ingresa tu nombre" [(ngModel)]="loginForm.name">
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">EDAD *</ion-label>
        <ion-input type="number" placeholder="Ingresa tu edad" [(ngModel)]="loginForm.age">
        </ion-input>
      </ion-item>
      <ion-button expand="block" (click)="login()" class="ion-margin-top">
        <ion-icon name="log-in-outline" slot="start"></ion-icon>
        Iniciar Sesi√≥n
      </ion-button>
      <ion-button expand="block" (click)="loginsUser()" class="ion-margin-top">
        <ion-icon name="person-add-outline" slot="start"></ion-icon>
        Ir a registro de usuario
      </ion-button>
    </ion-card-content>
  </ion-card>
  }

  <!-- SECCI√ìN DE ADMINISTRACI√ìN (solo visible para usuarios logueados) -->
  @if (isLoggedIn && user) {

  <!-- SECCI√ìN DE PERFIL DE USUARIO -->
  <ion-card style="padding-bottom: 20px;">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="person-circle-outline"></ion-icon>
        Perfil de Usuario {{ user?.name }}
      </ion-card-title>
      <ion-card-subtitle>¬°Bienvenido/a. Como adulto responsable, puede acceder a los avances y observaciones del menor
        que tiene a su cargo. !</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">Nombre</ion-label>
        <ion-input type="text" [(ngModel)]="user!.name">
        </ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="stacked">Edad</ion-label>
        <ion-input type="number" [(ngModel)]="user!.age">
        </ion-input>
      </ion-item>
    </ion-card-content>
  </ion-card>


  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="add-outline"></ion-icon>
        Gesti√≥n pacientes
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Nombre del Paciente</ion-label>
        <ion-input [(ngModel)]="child.name" required></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Edad</ion-label>
        <ion-input [(ngModel)]="child.age" type="number" required></ion-input>
      </ion-item>
      <ion-button expand="block" (click)="registerChild()" [disabled]="!child.name || !child.age"
        class="ion-margin-top()">Agregar Paciente</ion-button>
    </ion-card-content>
  </ion-card>

  <!-- tabla de pacientes -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        Pacientes asignados
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        @for (child of listPatientsByTutor; track child.id) {
        <ion-item>
          <ion-label>{{ child.name }} - {{ child.age }} anÃÉos</ion-label>
        </ion-item>
        }
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-button expand="block" (click)="congifTopics()"
    class="ion-margin-top()">Ir a configurar temas y actividades</ion-button>


  <!-- <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="add-outline"></ion-icon>
          Gesti√≥n de Contenido
        </ion-card-title>
        <ion-card-subtitle>Agregar contenido para cada categor√≠a de pr√°ctica</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        
      
        <ion-item>
          <ion-label position="stacked">Categor√≠a *</ion-label>
          <ion-select 
            placeholder="Selecciona una categor√≠a"
            [(ngModel)]="selectedPracticeCategory">
            @for (option of practiceOptions; track option.id) {
              <ion-select-option [value]="option.id">
                {{ option.title }}
              </ion-select-option>
            }
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Nombre del elemento *</ion-label>
          <ion-input 
            type="text" 
            placeholder="Ej: Vocal A, N√∫mero 1, Palabra Casa..."
            [(ngModel)]="newPracticeItem.name">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Descripci√≥n</ion-label>
          <ion-textarea 
            placeholder="Descripci√≥n opcional del elemento"
            rows="2"
            [(ngModel)]="newPracticeItem.description">
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Imagen</ion-label>
          <input 
            type="file" 
            accept="image/*" 
            (change)="onFileSelected($event, 'image')"
            style="margin-top: 10px;">
          @if (newPracticeItem.image) {
            <ion-text color="success">
              <p>Archivo: {{ newPracticeItem.image }}</p>
            </ion-text>
          }
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Audio</ion-label>
          <input 
            type="file" 
            accept="audio/*" 
            (change)="onFileSelected($event, 'audio')"
            style="margin-top: 10px;">
          @if (newPracticeItem.audio) {
            <ion-text color="success">
              <p>Archivo: {{ newPracticeItem.audio }}</p>
            </ion-text>
          }
        </ion-item>

        <ion-button 
          expand="block" 
          (click)="addPracticeData()" 
          [disabled]="!selectedPracticeCategory || !newPracticeItem.name"
          class="ion-margin-top">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Agregar Elemento
        </ion-button>
      </ion-card-content>
    </ion-card> -->


  <!-- GESTI√ìN DE DATOS PARA LA APLICACI√ìN -->
  <!-- <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="add-outline"></ion-icon>
          Gesti√≥n de Contenido
        </ion-card-title>
        <ion-card-subtitle>Agregar contenido para cada categor√≠a de pr√°ctica</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        
      
        <ion-item>
          <ion-label position="stacked">Categor√≠a *</ion-label>
          <ion-select 
            placeholder="Selecciona una categor√≠a"
            [(ngModel)]="selectedPracticeCategory">
            @for (option of practiceOptions; track option.id) {
              <ion-select-option [value]="option.id">
                {{ option.title }}
              </ion-select-option>
            }
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Nombre del elemento *</ion-label>
          <ion-input 
            type="text" 
            placeholder="Ej: Vocal A, N√∫mero 1, Palabra Casa..."
            [(ngModel)]="newPracticeItem.name">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Descripci√≥n</ion-label>
          <ion-textarea 
            placeholder="Descripci√≥n opcional del elemento"
            rows="2"
            [(ngModel)]="newPracticeItem.description">
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Imagen</ion-label>
          <input 
            type="file" 
            accept="image/*" 
            (change)="onFileSelected($event, 'image')"
            style="margin-top: 10px;">
          @if (newPracticeItem.image) {
            <ion-text color="success">
              <p>Archivo: {{ newPracticeItem.image }}</p>
            </ion-text>
          }
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Audio</ion-label>
          <input 
            type="file" 
            accept="audio/*" 
            (change)="onFileSelected($event, 'audio')"
            style="margin-top: 10px;">
          @if (newPracticeItem.audio) {
            <ion-text color="success">
              <p>Archivo: {{ newPracticeItem.audio }}</p>
            </ion-text>
          }
        </ion-item>

        <ion-button 
          expand="block" 
          (click)="addPracticeData()" 
          [disabled]="!selectedPracticeCategory || !newPracticeItem.name"
          class="ion-margin-top">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Agregar Elemento
        </ion-button>
      </ion-card-content>
    </ion-card> -->

  <!-- RESUMEN DE CONTENIDO POR CATEGOR√çA -->
  <!-- <ion-card>
      <ion-card-header>
        <ion-card-title>Contenido Disponible</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-accordion-group>
          @for (option of practiceOptions; track option.id) {
            <ion-accordion [value]="option.id">
              <ion-item slot="header" [color]="option.color">
                <ion-label>
                  {{ option.title }}
                  <ion-badge color="light" class="ion-margin-start">
                    {{ getPracticeDataCount(option.id) }}
                  </ion-badge>
                </ion-label>
              </ion-item>
              
              <div class="ion-padding" slot="content">
                @if (practiceData[option.id].length === 0) {
                  <ion-text color="medium">
                    <p>No hay contenido disponible para esta categor√≠a.</p>
                  </ion-text>
                } @else {
                  <ion-list>
                    @for (item of practiceData[option.id]; track item.id) {
                      <ion-item>
                        <ion-label>
                          <h3>{{ item.name }}</h3>
                          @if (item.description) {
                            <p>{{ item.description }}</p>
                          }
                          <div class="file-info">
                            @if (item.image) {
                              <ion-text color="primary">
                                <small>üñºÔ∏è {{ item.image }}</small>
                              </ion-text>
                            }
                            @if (item.audio) {
                              <ion-text color="secondary">
                                <small>üîä {{ item.audio }}</small>
                              </ion-text>
                            }
                          </div>
                        </ion-label>
                        <ion-button 
                          fill="clear" 
                          color="danger" 
                          slot="end"
                          (click)="deletePracticeData(option.id, item.id)">
                          <ion-icon name="trash-outline"></ion-icon>
                        </ion-button>
                      </ion-item>
                    }
                  </ion-list>
                }
              </div>
            </ion-accordion>
          }
        </ion-accordion-group>
      </ion-card-content>
    </ion-card> -->

  }





  }
</ion-content>